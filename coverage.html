
<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>client: Go Coverage Report</title>
		<style>
			body {
				background: black;
				color: rgb(80, 80, 80);
			}
			body, pre, #legend span {
				font-family: Menlo, monospace;
				font-weight: bold;
			}
			#topbar {
				background: black;
				position: fixed;
				top: 0; left: 0; right: 0;
				height: 42px;
				border-bottom: 1px solid rgb(80, 80, 80);
			}
			#content {
				margin-top: 50px;
			}
			#nav, #legend {
				float: left;
				margin-left: 10px;
			}
			#legend {
				margin-top: 12px;
			}
			#nav {
				margin-top: 10px;
			}
			#legend span {
				margin: 0 5px;
			}
			.cov0 { color: rgb(192, 0, 0) }
.cov1 { color: rgb(128, 128, 128) }
.cov2 { color: rgb(116, 140, 131) }
.cov3 { color: rgb(104, 152, 134) }
.cov4 { color: rgb(92, 164, 137) }
.cov5 { color: rgb(80, 176, 140) }
.cov6 { color: rgb(68, 188, 143) }
.cov7 { color: rgb(56, 200, 146) }
.cov8 { color: rgb(44, 212, 149) }
.cov9 { color: rgb(32, 224, 152) }
.cov10 { color: rgb(20, 236, 155) }

		</style>
	</head>
	<body>
		<div id="topbar">
			<div id="nav">
				<select id="files">
				
				<option value="file0">github.com/luxrobo/luxpay/src/client/iamport.go (0.0%)</option>
				
				<option value="file1">github.com/luxrobo/luxpay/src/client/toss.go (83.8%)</option>
				
				</select>
			</div>
			<div id="legend">
				<span>not tracked</span>
			
				<span class="cov0">not covered</span>
				<span class="cov8">covered</span>
			
			</div>
		</div>
		<div id="content">
		
		<pre class="file" id="file0" style="display: none">package client

import (
        "bytes"
        "encoding/json"
        "net/http"
)

const impApiUrl string = "https://api.iamport.kr/"

type IamportClient struct {
        apiUrl        string
        Authorization string
}

type AccessTokenPayload struct {
        ImpKey    string `json:"imp_key"`
        ImpSecret string `json:"imp_secret"`
}

type AccessTokenResp struct {
        Code     int    `json:"code"`
        Message  string `json:"message"`
        Response struct {
                AccessToken string `json:"access_token"`
                ExpiredAt   int    `json:"expired_at"`
                Now         int    `json:"now"`
        } `json:"response"`
}

type CustomerPayload struct {
        CustomerUid string `json:"customer_uid"`
        CardNumber  string `json:"card_number"`
        Expiry      string `json:"expiry"`
        Birth       string `json:"birth"`
        Password    string `json:"pwd_2digit"`
}

type CustomerResp struct {
        Code     int    `json:"code"`
        Message  string `json:"message"`
        Response struct {
                CustomerUid      string `json:"customer_uid"`
                PgProvider       string `json:"pg_provider"`
                PgId             string `json:"pg_id"`
                CardName         string `json:"card_name"`
                CardCode         string `json:"card_code"`
                CardNumber       string `json:"card_number"`
                CardType         string `json:"card_type"`
                CustomerName     string `json:"customer_name"`
                CustomerTel      string `json:"customer_tel"`
                CustomerEmail    string `json:"customer_email"`
                CustomerAddr     string `json:"customer_addr"`
                CustomerPostcode string `json:"customer_postcode"`
                Inserted         int    `json:"inserted"`
                Updated          int    `json:"updated"`
        } `json:"response"`
}

type MakePaymentPayload struct {
        CustomerUid string `json:"customer_uid"`
        MerchantUid string `json:"merchant_uid"`
        Amount      int    `json:"amount"`
        Name        string `json:"name"`
}

type MakePaymentResp struct {
        Code     int    `json:"code"`
        Message  string `json:"message"`
        Response struct {
                ImpUid        string `json:"imp_uid"`
                MerchantUid   string `json:"merchant_uid"`
                PayMethod     string `json:"pay_method"`
                Channel       string `json:"channel"`
                PgProvider    string `json:"pg_provider"`
                EmbPgProvider string `json:"emb_pg_provider"`
                PgTid         string `json:"pg_tid"`
                PgId          string `json:"pg_id"`
                Escrow        bool   `json:"escrow"`
                ApplyNum      string `json:"apply_num"`
                BankCode      string `json:"bank_code"`
                BankName      string `json:"bank_name"`
                CardCode      string `json:"card_code"`
                CardName      string `json:"card_name"`
                CardQuota     int    `json:"card_quota"`
                CardNumber    string `json:"card_number"`
                CardType      string `json:"card_type"`
        } `json:"response"`
}

func NewIamportClient(iamportKey string, iamportSecret string) *IamportClient <span class="cov0" title="0">{
        accessTokenStruct := getAccessToken(iamportKey, iamportSecret)
        accessToken := accessTokenStruct.Response.AccessToken
        return &amp;IamportClient{
                apiUrl:        "https://api.iamport.kr/",
                Authorization: accessToken,
        }
}</span>

func getAccessToken(iamportKey string, iamportSecret string) AccessTokenResp <span class="cov0" title="0">{
        payload := AccessTokenPayload{
                ImpKey:    iamportKey,
                ImpSecret: iamportSecret,
        }
        jsonPayload, err := json.Marshal(payload)
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov0" title="0">req, err := http.NewRequest(
                "POST",
                impApiUrl+"users/getToken",
                bytes.NewBuffer(jsonPayload),
        )
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov0" title="0">req.Header.Add("Content-Type", "application/json")

        client := &amp;http.Client{}
        resp, err := client.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }
        <span class="cov0" title="0">defer resp.Body.Close()

        var data AccessTokenResp
        json.NewDecoder(resp.Body).Decode(&amp;data)
        return data</span>
}

func (ic IamportClient) CreateCustomer(
        customerUid string,
        cardNumber string,
        expiry string,
        birth string,
        password string,
) CustomerResp <span class="cov0" title="0">{
        payload := CustomerPayload{
                CustomerUid: customerUid,
                CardNumber:  cardNumber,
                Expiry:      expiry,
                Birth:       birth,
                Password:    password,
        }
        jsonPayload, err := json.Marshal(payload)
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov0" title="0">req, err := http.NewRequest(
                "POST",
                impApiUrl+"subscribe/customers/"+customerUid,
                bytes.NewBuffer(jsonPayload),
        )
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov0" title="0">req.Header.Add("Authorization", ic.Authorization)
        req.Header.Add("Content-Type", "application/json")

        client := &amp;http.Client{}
        resp, err := client.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }
        <span class="cov0" title="0">defer resp.Body.Close()

        var data CustomerResp
        json.NewDecoder(resp.Body).Decode(&amp;data)
        return data</span>
}

func (ic IamportClient) MakePayment(
        customerUid string,
        merchantUid string,
        amount int,
        paymentName string,
) MakePaymentResp <span class="cov0" title="0">{
        payload := MakePaymentPayload{
                CustomerUid: customerUid,
                MerchantUid: merchantUid,
                Amount:      amount,
                Name:        paymentName,
        }
        jsonPayload, err := json.Marshal(payload)
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov0" title="0">req, err := http.NewRequest(
                "POST",
                impApiUrl+"subscribe/payments/again",
                bytes.NewBuffer(jsonPayload),
        )
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov0" title="0">req.Header.Add("Authorization", ic.Authorization)
        req.Header.Add("Content-Type", "application/json")

        client := &amp;http.Client{}
        resp, err := client.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }
        <span class="cov0" title="0">defer resp.Body.Close()

        var data MakePaymentResp
        json.NewDecoder(resp.Body).Decode(&amp;data)
        return data</span>
}
</pre>
		
		<pre class="file" id="file1" style="display: none">package client

import (
        "bytes"
        "encoding/base64"
        "encoding/json"
        "net/http"
)

type BillingKeyPayload struct {
        CardNumber          string `json:"cardNumber"`
        CardExpirationYear  string `json:"cardExpirationYear"`
        CardExpirationMonth string `json:"cardExpirationMonth"`
        CardPassword        string `json:"cardPassword"`
        CustomerBirthday    string `json:"customerBirthday"`
        CustomerKey         string `json:"customerKey"`
}

type BillingKeyResp struct {
        MID             string `json:"mId"`
        CustomerKey     string `json:"customerKey"`
        AuthenticatedAt string `json:"authenticatedAt"`
        Method          string `json:"method"`
        BillingKey      string `json:"billingKey"`
        Company         string `json:"cardCompany"`
        Number          string `json:"cardNumber"`
}

type PaymentPayload struct {
        OrderName   string `json:"orderName"`
        OrderId     string `json:"orderId"`
        OrderAmount string `json:"amount"`
        CustomerKey string `json:"customerKey"`
}

type PaymentResp struct {
        ApprovedAt    string `json:"approvedAt"`
        BalanceAmount string `json:"balanceAmount"`
        Cancels       string `json:"cancels"`
        Card          struct {
                AcquireStatus         string `json:"acquireStatus"`
                ApproveNo             string `json:"approveNo"`
                CardType              string `json:"cardType"`
                CardCompany           string `json:"company"`
                InstallmentPlanMonths int    `json:"installmentPlanMonths"`
                IsInterestFree        bool   `json:"isInterestFree"`
                CardNumber            string `json:"number"`
                OwnerType             string `json:"ownerType"`
                ReceiptUrl            string `json:"receiptUrl"`
                UseCardPoint          bool   `json:"useCardPoint"`
        } `json:"card"`
        CashReceipt         string `json:"cashReceipt"`
        Currency            string `json:"currency"`
        Discount            string `json:"discount"`
        DiscountAmount      int    `json:"discountAmount"`
        GiftCertificate     string `json:"giftCertificate"`
        IsPartialCancelable bool   `json:"isPartialCancelable"`
        MId                 string `json:"mId"`
        Method              string `json:"method"`
        MobilePhone         string `json:"mobilePhone"`
        OrderId             string `json:"orderId"`
        PaymentKey          string `json:"paymentKey"`
        RequestedAt         string `json:"requestedAt"`
        Secret              string `json:"secret"`
        Status              string `json:"status"`
        TotalAmount         int    `json:"totalAmount"`
        UseCashReceipt      bool   `json:"useCashReceipt"`
        UseDiscount         bool   `json:"useDiscount"`
        UseEscrow           bool   `json:"useEscrow"`
        VirtualAccount      string `json:"virtualAccount"`
}

const apiUrl string = "https://api.tosspayments.com/"
const contentType string = "application/json"

type Header struct {
        Authorization string
        ContentType   string
}

type TossClient struct {
        apiUrl string
        header Header
}

func NewTossClient(tossSecret string) *TossClient <span class="cov8" title="1">{
        authToken := getAuthToken(tossSecret)
        return &amp;TossClient{
                apiUrl: apiUrl,
                header: Header{
                        Authorization: "Basic " + authToken,
                        ContentType:   contentType,
                },
        }
}</span>

func getAuthToken(tossSecret string) string <span class="cov8" title="1">{
        return base64.StdEncoding.EncodeToString([]byte(tossSecret + ":"))
}</span>

func (tc TossClient) CreateBillingKey(
        cardNumber string,
        cardExpirationYear string,
        cardExpirationMonth string,
        cardPassword string,
        customerBirthday string,
        customerUid string,
) BillingKeyResp <span class="cov8" title="1">{

        payload := BillingKeyPayload{
                CardNumber:          cardNumber,
                CardExpirationYear:  cardExpirationYear,
                CardExpirationMonth: cardExpirationMonth,
                CardPassword:        cardPassword,
                CustomerBirthday:    customerBirthday,
                CustomerKey:         customerUid,
        }

        jsonPayload, err := json.Marshal(payload)
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov8" title="1">req, err := http.NewRequest(
                "POST",
                apiUrl+"v1/billing/authorizations/card",
                bytes.NewBuffer(jsonPayload),
        )
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov8" title="1">req.Header.Add("Authorization", tc.header.Authorization)
        req.Header.Add("Content-Type", tc.header.ContentType)

        client := &amp;http.Client{}
        resp, err := client.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }
        <span class="cov8" title="1">defer resp.Body.Close()

        var data BillingKeyResp
        json.NewDecoder(resp.Body).Decode(&amp;data)
        return data</span>
}

func (tc TossClient) MakePayment(
        billingKey string,
        orderName string,
        orderId string,
        orderAmount string,
        customerUid string,
) PaymentResp <span class="cov8" title="1">{
        payload := PaymentPayload{
                OrderName:   orderName,
                OrderId:     orderId,
                OrderAmount: orderAmount,
                CustomerKey: customerUid,
        }

        jsonPayload, err := json.Marshal(payload)
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov8" title="1">req, err := http.NewRequest(
                "POST",
                apiUrl+"v1/billing/"+billingKey,
                bytes.NewBuffer(jsonPayload),
        )
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }

        <span class="cov8" title="1">req.Header.Add("Authorization", tc.header.Authorization)
        req.Header.Add("Content-Type", tc.header.ContentType)

        client := &amp;http.Client{}
        resp, err := client.Do(req)
        if err != nil </span><span class="cov0" title="0">{
                panic(err)</span>
        }
        <span class="cov8" title="1">defer resp.Body.Close()

        var data PaymentResp
        json.NewDecoder(resp.Body).Decode(&amp;data)
        return data</span>
}
</pre>
		
		</div>
	</body>
	<script>
	(function() {
		var files = document.getElementById('files');
		var visible;
		files.addEventListener('change', onChange, false);
		function select(part) {
			if (visible)
				visible.style.display = 'none';
			visible = document.getElementById(part);
			if (!visible)
				return;
			files.value = part;
			visible.style.display = 'block';
			location.hash = part;
		}
		function onChange() {
			select(files.value);
			window.scrollTo(0, 0);
		}
		if (location.hash != "") {
			select(location.hash.substr(1));
		}
		if (!visible) {
			select("file0");
		}
	})();
	</script>
</html>
